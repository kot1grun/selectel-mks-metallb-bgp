# Selectel Managed Kubernetes Services + MetalLB in L3 mode + BGP

Проект предаствляет набор манифестов Terraform для развертывания демо-стенда инфраструктуры с управляемым Kubernetes и балансирощиком MetalLB, работающем в режиме layer 3 и анонсированием адресов по BGP.

## Что создается в инфраструктуре:

1. Сети и подсети в разных пулах.
2. По одной ВМ с интерфейсом и адресом во внешней линковочной сети в разных пулах.
3. Два кластеры Kubernetes в разных пулах.

## Как настраивается ВМ:

1. Обновляются пакеты и устанавливаются недостающие.
2. Выключается cloud-init для конфигурации сети.
3. Включается форвардинг пакетов IPv4.
4. Настраивается netfilter/nftables.
5. Добавляется репозиторий frr.
6. Устанавиливается frr из репозитория
7. Настраивается запуск bgpd
8. В frr настраивается BGP neighbor.

## Как это запустить?

1. Установить все необходимые программы и утилиты.
2. Клонировать репозиторий.
3. Перейти в tf_infra/ .
4. Выполнить:

```shell
terraform init
terraform plan
terraform apply -target=terraform_data.ridge_one
terraform apply -target=terraform_data.ridge_two
terraform apply
```

5. Проверить ответ от echoserver-а.
